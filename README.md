# Infosec Lab 1 API

Безопасное REST API для лабораторной работы, построенное на FastAPI, SQLAlchemy и SQLite. Реализует JWT аутентификацию, базовые CRUD операции с постами и меры безопасности в соответствии с рекомендациями OWASP Top 10.

## Технологический стек

- Python 3.11
- FastAPI + Uvicorn
- SQLAlchemy 2 + SQLite
- Аутентификация: JWT (`PyJWT`), хеширование паролей (`passlib[bcrypt]`)
- Санитизация XSS: `bleach`
- Инструменты: `uv` (менеджер окружений и пакетов), `ruff`, `black`, `pytest`, `bandit`, `safety`

## Установка

```bash
uv sync --extra dev   # установка зависимостей для рабочего и дев-окружения в изолированное .venv с помощью uv
uv run uvicorn app.main:app --app-dir src --reload
```

Необязательные переменные окружения можно хранить в файле `.env`, например: `APP_SECRET_KEY`, `APP_DATABASE_URL` и другие. Значения по умолчанию подходят для локального тестирования.

## Обзор API

| Метод | Путь | Описание |
| --- | --- | --- |
| POST | `/auth/register` | Создание пользователя (имя пользователя от 3 до 100 символов, пароль от 6 до 200) |
| POST | `/auth/login` | Получение JWT токена доступа |
| GET | `/api/posts` | Список постов (требуется аутентификация) |
| POST | `/api/posts` | Создание поста (требуется аутентификация) |

Используйте заголовок `Authorization: Bearer <token>` для защищённых эндпоинтов.

## Меры безопасности

- **SQL инъекции**: Использование SQLAlchemy ORM с параметризированными запросами; нет конкатенации строк SQL.
- **XSS**: Заголовки и содержимое постов санитизируются через `bleach.clean` перед сохранением в базу и при сериализации ответа.
- **Аутентификация**: JWT токены подписаны с использованием HMAC и имеют срок действия, пароли хешируются с помощью bcrypt через `passlib`. 

## Тестирование и CI

- `uv run pytest -q` — интеграционные тесты с использованием FastAPI TestClient (добавлены позднее).
- `.github/workflows/ci.yml` — GitHub Actions срабатывает на `push`/`pull_request` в `master`, выполняет `uv sync --dev`, затем шаги lint (`ruff`, `black --check`), тестирование (`pytest -q --maxfail=1`) и проверки безопасности (`bandit`, `safety`, `snyk`).